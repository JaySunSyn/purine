<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="data-model">
  <script type="text/javascript" src="../../bower_components/js-data/dist/js-data.min.js"></script>
  <script type="text/javascript" src="../../bower_components/js-data-http/dist/js-data-http.min.js"></script>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'data-model',

      properties: {
        store: Object,
        dose: {
          type: Object,
          notify: true
        }
      },

      attached: function() {
        this.store = new JSData.DS({
          idAttribute: 'date',
          beforeInject: function(resource, data) {
            return data.dose;
          },

          afterFind: function(Resource, data, cb) {
           // Must return the data or a promise that resolves with the data
           cb(null, {
            date: data.dose.date,
            data: data.dose
          });
          }
        });

        var httpAdapter = new DSHttpAdapter();
        httpAdapter.defaults.basePath = 'https://arts-dose.appspot.com/_ah/api/artsdose/v1/';
        httpAdapter.defaults.suffix = '?token=3bd289f1ab1851af761d95235450f629';
        this.store.registerAdapter('http', httpAdapter, { default: true });

        this.store.defineResource({
          name: 'dose'
        });

        var promise = this.store.find('dose', '').then(function (dose) {
          this.dose = dose;
        }.bind(this));
      },

      yo: function() {
        debugger
      }
    });
  })();
  </script>
</dom-module>
